<!doctype html>
<html lang="en">

<!--í—¤ë”-->
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap demo</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootswatch@4.5.2/dist/minty/bootstrap.min.css"
          integrity="sha384-H4X+4tKc7b8s4GoMrylmy2ssQYpDHoqzPa9aKXbDwPoPUA3Ra8PA5dGzijN+ePnH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <script src="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.1/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        td {
            border-style: none;
        }
    </style>
</head>


<!--  ë¹„ ë‚´ë¦¬ëŠ” ë“¯í•œ ë°°ê²½ íš¨ê³¼ ì ìš© <style> + select box ì»¤ìŠ¤í…€   -->

<div class="rain"></div>
<style>

    .rain {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background-color: aqua;
        position: absolute;
        top: -8px;
    }

    .select {
        width: 150px;
        height: 35px;
        background: url('https://freepikpsd.com/media/2019/10/down-arrow-icon-png-7-Transparent-Images.png') calc(100% - 5px) center no-repeat;
        background-size: 20px;
        padding: 5px 30px 5px 10px;
        border-radius: 4px;
        outline: 0 none;
        font-family: Montserrat;
    }

    .select option {
        background: black;
        color: #fff;
        padding: 3px 0;
    }

    .selectBox {
        position: relative;
        width: 150px;
        height: 35px;
        border-radius: 4px;
        border: 2px solid #78C2AD;
    }

    .selectBox .select {
        width: inherit;
        height: inherit;
        background: transparent;
        border: 0 none;
        outline: 0 none;
        padding: 0 5px;
        position: relative;
        z-index: 3;
    }

    .selectBox .select option {
        background: #78C2AD;
        color: white;
        padding: 3px 0;
        font-size: 16px;
        font-family: Montserrat;
    }

    @keyframes fall {
        from {
        }
        to {
            transform: translateY(90vh);
            opacity: 0;
        }

    }
</style>


<script>

    // ë¹„ ë‚´ë¦¬ëŠ” íš¨ê³¼ êµ¬í˜„

    const body = document.querySelector("body");

    const MIN_DURATION = 10;

    function makeRain() {
        const rainEffect = document.createElement("div");
        const delay = Math.random() * 10;
        const initialOpacity = Math.random();
        const duration = Math.random() * 20 + MIN_DURATION;

        rainEffect.classList.add("rain");
        rainEffect.style.left = `${Math.random() * window.screen.width}px`;
        rainEffect.style.animationDelay = `${delay}s`;
        rainEffect.style.opacity = initialOpacity;
        rainEffect.style.animation = `fall ${duration}s linear`;


        body.appendChild(rainEffect);

        setTimeout(() => {
            body.removeChild(rainEffect);
            makeRain();
        }, (duration + delay) * 1000);

    }

    makeRain();
    for (let index = 0; index < 50; index++) {
        setTimeout(makeRain, 500 * index);
    }

    // ë¡œê·¸ì•„ì›ƒ, localstorage ì—ì„œ í† í° ì œê±°

    function removeToken() {
        localStorage.removeItem("token");
        alert("ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.");
    }
</script>


<!--    Nav Bar    -->

<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container-fluid">
        <a class="navbar-brand" href="/"> ğŸ¡í™ˆí™”ë©´</a>
        <a class="navbar-brand" href="/posts">ê²Œì‹œíŒ ì´ë™</a>

        <div class="collapse navbar-collapse justify-content-end" id="navbarColor01">
            <ul class="navbar-nav me-auto">


                {{^loginUserName}}
                    <li class="nav-item">
                        <a class="nav-link" href="/users/join">íšŒì›ê°€ì…</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/users/login">ë¡œê·¸ì¸ </a>
                    </li>
                {{/loginUserName}}
                {{#loginUserName}}
                    <li class="nav-item">
                        <a class="nav-link">{{loginUserName}} ë‹˜ ë¡œê·¸ì¸ ì¤‘</a>
                    </li>
                    <li class="nav-item">
                        <form class="container" form action="/posts/my" method="get">
                            <button class="btn btn-success btn-lg" type="submit">
                                ë§ˆì´í˜ì´ì§€
                            </button>
                        </form>
                    </li>
                    <li class="nav-item">
                        <button class="btn btn-light btn-lg" type="button" data-toggle="collapse"
                                data-target=".multi-collapse-alarm">
                            ğŸ””
                        </button>
                    </li>

                    <li class="nav-item">
                        <form class="container" form action="/users/logout" method="get">
                            <button class="btn btn-success btn-lg" type="submit" onclick="return removeToken();">
                                ë¡œê·¸ì•„ì›ƒ
                            </button>
                        </form>
                    </li>
                {{/loginUserName}}


            </ul>
        </div>
    </div>
</nav>
<div style="position: absolute;top: 60px;right: 70px;">

    <table class="collapse multi-collapse-alarm table table-striped table-hover" style="width: 50%" align="right">
        <tbody>
        <thead class="table-light">

        {{#alarms}}
            <tr>
                <th scope="row" style="text-align: center;font-size: xx-small;">
                <a href="/posts/{{postId}}">
                    ã€{{fromUserName}}ã€‘ë‹˜ì´ ã€{{PostName}}ã€‘ ê²Œì‹œê¸€ì— {{text}} {{createdAt}}</th>
                </a>
                <th scope="row" style="text-align: center;font-size: xx-small;">
                    <button type="button" class="btn btn-primary btn-sm"
                            onclick="alarm.alarmDelete({{alarmId}})">
                        âœ”
                    </button>
                </th>
            </tr>
        {{/alarms}}

        </thead>
        </tbody>
    </table>
</div>
<br>


<script>
    const alarm = {
        init: function () {

            const _this = this;

        },

        /** ëŒ“ê¸€ ì‚­ì œ */
        alarmDelete: function (alarmId) {

            const url = `/api/v1/alarms/${alarmId}`;
            console.log(url);


            axios.delete(url, {
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${localStorage.getItem("token")}`
                        }
                    }
            ).then((response) => {
                        console.log(response);
                        window.location.href = document.location.href;
                    }
            ).catch((error) => {
                console.log(error.response.data.result);
                if (error.response.data.result["errorCode"] == "EXPIRED_TOKEN") {
                    alert("í† í°ì´ ë§Œë£Œë˜ì—ˆìœ¼ë‹ˆ ë‹¤ì‹œ ë¡œê·¸ì¸ í•´ì£¼ì„¸ìš”");
                    window.location.href = '/users/login';
                } else if (error.response.data.result["errorCode"] == "TOKEN_NOT_FOUND") {
                    alert("ë¡œê·¸ì¸ í›„ ì´ìš©í•´ì£¼ì„¸ìš”");
                    window.location.href = '/users/login';
                } else if (error.response.data.result["errorCode"] == "INVALID_TOKEN") {
                    alert("ë¡œê·¸ì¸ í›„ ì´ìš©í•´ì£¼ì„¸ìš”");
                    window.location.href = '/users/login';
                }else if (error.response.data.result["errorCode"] == "ALARM_NOT_FOUND") {
                    alert("ì´ë¯¸ ì²´í¬ëœ ì•Œë¦¼ì…ë‹ˆë‹¤.");
                } else {
                    alert("ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì—ëŸ¬ê°€ ê³„ì†ëœë‹¤ë©´ ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”");
                }
            });
        }

    }

    alarm.init();

</script>
