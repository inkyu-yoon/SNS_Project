<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<!-- header -->
<th:block th:replace="layout/header :: headerFragment"></th:block>

<br>

<div class="form-group" align="center">
    <h3>Welcome ğŸ¤—</h3>
    <br>
    <div class="form-floating mb-3">
        <label for="floatingInput"><strong>íšŒì› ëª…</strong></label>
        <input name="userName" type="text" class="form-control" id="input-userName" placeholder="íšŒì›ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"
               style="width:300px;height:50px;">
    </div>
    <div class="form-floating">
        <label for="floatingPassword"><strong>ë¹„ë°€ë²ˆí˜¸</strong></label>
        <input type ="password" name="password" class="form-control" id="input-password" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
               style="width:300px;height:50px;">
    </div>

    <br>

    <div class="form-floating">
        <input type ="password" name="password" class="form-control" id="input-password-check" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ í•œë²ˆë” ì…ë ¥í•´ì£¼ì„¸ìš”"
               style="width:300px;height:50px;">
    </div>

    <br>
    <button type="button" class="btn btn-primary btn-lg" id="user-create-btn" onclick="user.userCreate()">íšŒì›ê°€ì…</button>
</div>


<Script>

    let user = {

        init: function () {

            var _this = this;

        },

        userCreate: function () {

            let data = {
                userName: document.querySelector('#input-userName').value.trim(),
                password: document.querySelector('#input-password').value.trim(),
            };
            var blank_pattern = /[\s]/g;

            if (blank_pattern.test(data.userName) == true || data.userName == '') {
                alert('íšŒì›ëª…ì— ê³µë°±ì´ ì…ë ¥ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }
            if (blank_pattern.test(data.password) == true || data.password == '') {
                alert('ë¹„ë°€ë²ˆí˜¸ì— ê³µë°±ì´ ì…ë ¥ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }

            if (data.userName.length >= 15) {
                alert('íšŒì›ëª…ì€ 15ê¸€ì ì´í•˜ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                return;
            }


            const con_check = confirm("íšŒì›ê°€ì…ì„ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?");

            const password = document.querySelector('#input-password').value.trim();
            const passwordCheck = document.querySelector('#input-password-check').value;

            if (password != passwordCheck) {
                alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }

            if (con_check === true) {
                axios.post("/api/v1/users/join",
                        JSON.stringify(data), {
                            headers: {
                                'Content-Type': 'application/json'
                            }
                        }
                ).then((response) => {
                    alert("íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
                    window.location.href = '/';
                }).catch((error) => {
                    console.log(error.response.data.result["errorCode"])
                    if (error.response.data.result["errorCode"] == "DUPLICATED_USER_NAME") {
                        alert("ì´ë¯¸ ê°€ì…ëœ íšŒì›ì…ë‹ˆë‹¤. ë‹¤ë¥¸ íšŒì›ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                    } else if (error.response.data.result["errorCode"] == "BLANK_NOT_ALLOWED") {
                        alert("íšŒì›ëª… í˜¹ì€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”");
                    } else {
                        alert("ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì—ëŸ¬ê°€ ê³„ì†ëœë‹¤ë©´ ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”");
                    }
                });
            }
        }
    };
    user.init();
</script>